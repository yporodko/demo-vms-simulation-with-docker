[general]
static=yes
writeprotect=no
autofallthrough=yes

[globals]

[default]
; Simple default context
exten => _X.,1,NoOp(Incoming call to ${EXTEN})
same => n,Answer()
same => n,Playback(demo-congrats)
same => n,Hangup()

[incoming]
; Handle all incoming calls with randomized behavior
exten => _X.,1,NoOp(Call from ${CALLERID(num)} to ${EXTEN})
same => n,Set(TIMEOUT(absolute)=120)
same => n,Answer()
same => n,Wait(1)

; Ring for random time 10-20 seconds
same => n,Set(RING_TIME=${RAND(10,20)})
same => n,Ringing()
same => n,Wait(${RING_TIME})

; Decide outcome: 12% busy, 33% no answer, 55% answered
same => n,Set(RAND_NUM=${RAND(1,100)})
same => n,GotoIf($[${RAND_NUM} <= 12]?busy)
same => n,GotoIf($[${RAND_NUM} <= 45]?noanswer)

; Answer and play audio
same => n(answered),NoOp(Call ANSWERED)
same => n,Set(PLAY_TIME=${RAND(15,45)})
same => n,Set(START_TIME=${EPOCH})
same => n(playloop),Playback(tt-monkeys&silence/1)
same => n,Set(ELAPSED=$[${EPOCH} - ${START_TIME}])
same => n,GotoIf($[${ELAPSED} < ${PLAY_TIME}]?playloop)
same => n,Hangup()

; Busy outcome
same => n(busy),NoOp(Call BUSY)
same => n,Playtones(busy)
same => n,Wait(5)
same => n,Hangup()

; No answer outcome
same => n(noanswer),NoOp(Call NO ANSWER)
same => n,Ringing()
same => n,Wait(30)
same => n,Hangup()
